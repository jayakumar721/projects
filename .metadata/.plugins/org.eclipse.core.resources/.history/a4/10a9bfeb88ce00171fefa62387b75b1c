package in.vamsoft.services;

import java.io.IOException;
import java.time.LocalDate;
import java.time.format.DateTimeFormatter;
import java.util.List;

import javax.servlet.RequestDispatcher;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import in.vamsoft.model.Employee;

/**
 * Servlet implementation class EmployeeDetails
 */
@WebServlet("/EmployeeDetails")
public class EmployeeDetails extends HttpServlet {
  private static final long serialVersionUID = 1L;

  /**
   * @see HttpServlet#doPost(HttpServletRequest request, HttpServletResponse
   *      response)
   */
  protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

    
    String name = request.getParameter("name");
    int id = Integer.parseInt(request.getParameter("id"));
    double salary = Double.parseDouble(request.getParameter("salary"));
    LocalDate date = LocalDate.parse(request.getParameter("doj"),DateTimeFormatter.ofPattern("dd-MM-yyyy"));
    ServiceDao service = new EmpServices();
    String opt = request.getParameter("operation");
    if (opt.equals("get")) { 
      int deptId = Integer.parseInt(request.getParameter("deptId"));
      List<Employee> employees = service.getEmoloyeeByDept(deptId);
      HttpSession session = request.getSession();
      session.setAttribute("employees", employees);
      RequestDispatcher dispatcher = request.getRequestDispatcher("EmployeeDetails.jsp");
      dispatcher.include(request, response);
    } else if(opt.equals("add")) {
      int deptId = Integer.parseInt(request.getParameter("deptId"));
      Employee emp = new Employee(id, name, salary, date, deptId);
      boolean add = service.addEmployee(emp);
      if(add) {
        response.getWriter().println("added successfully");
      }
    } else if(opt.equals("delete")) {
      boolean del = service.deleteEmployee(id);
      if(del) {
        response.getWriter().println("deleted successfully");

      }
    }

  }

}
